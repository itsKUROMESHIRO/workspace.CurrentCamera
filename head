local inputservice = game:GetService("UserInputService")

-- Dictionary of FFlags and their values
local fflags = {
    FFlagNewLightAttenuation = "True",
    FFlagDebugSkyGray = "True",
    FIntDebugTextureManagerSkipMips = "8",
    FIntRenderShadowIntensity = "False",
    FFlagDisablePostFx = "True"
}

-- Apply FFlags safely
for flag, value in pairs(fflags) do
    local fflag = flag:gsub('DFInt', ''):gsub('DFFlag', ''):gsub('FFlag', ''):gsub('FInt', ''):gsub('DFString', ''):gsub('FString', '')
    value = tostring(value):gsub('"True"', 'true'):gsub('"False"', 'false')

    pcall(function()
        if getfflag(fflag) ~= nil then
            setfflag(fflag, value)
        end
    end)
end

-- Function to remove unwanted objects
local function removeUnwantedObjects()
    local toDestroy = {}
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("ParticleEmitter") or obj:IsA("Fire") or obj:IsA("Smoke") or obj:IsA("Sparkles") or obj:IsA("Explosion") then
            table.insert(toDestroy, obj)
        end
    end
    for _, obj in ipairs(toDestroy) do
        pcall(function() obj:Destroy() end)
    end
end

-- Disable terrain decoration safely
local function disableTerrainDecoration()
    local terrain = workspace:FindFirstChildOfClass("Terrain")
    if terrain then
        pcall(function()
            if terrain:FindFirstChild("Decoration") ~= nil then
                sethiddenproperty(terrain, "Decoration", false)
            end
        end)
    end
end

-- Efficiently handle new objects
local function handleNewObjects(obj)
    if obj:IsA("ParticleEmitter") or obj:IsA("Fire") or obj:IsA("Smoke") or obj:IsA("Sparkles") or obj:IsA("Explosion") then
        pcall(function() obj:Destroy() end)
    end
end

-- Prevent duplicate event connections
if _G.DescendantAddedConnection then
    _G.DescendantAddedConnection:Disconnect()
end

-- Execute optimizations
task.spawn(removeUnwantedObjects)
task.spawn(disableTerrainDecoration)

-- Handle new objects efficiently
_G.DescendantAddedConnection = workspace.DescendantAdded:Connect(handleNewObjects)
